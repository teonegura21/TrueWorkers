apiVersion: batch/v1
kind: CronJob
metadata:
  name: storage-lifecycle-audit
  namespace: platform
spec:
  schedule: "0 2 * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: storage-worker
          restartPolicy: OnFailure
          containers:
            - name: lifecycle-audit
              image: gcr.io/YOUR_PROJECT/mesteri-storage-worker:latest
              args: ["lifecycle-audit"]
              env:
                - name: RETENTION_POLICY_LOOKAHEAD_DAYS
                  value: "30"
                - name: GOOGLE_APPLICATION_CREDENTIALS
                  value: "/var/secrets/google/key.json"
              volumeMounts:
                - name: gcp-sa
                  mountPath: /var/secrets/google
                  readOnly: true
          volumes:
            - name: gcp-sa
              secret:
                secretName: storage-worker-sa
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: signed-url-refresh
  namespace: platform
spec:
  schedule: "*/30 * * * *"
  concurrencyPolicy: Replace
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: storage-worker
          restartPolicy: OnFailure
          containers:
            - name: signed-url-refresh
              image: gcr.io/YOUR_PROJECT/mesteri-storage-worker:latest
              args: ["refresh-signed-urls"]
              env:
                - name: SIGNED_URL_TTL_MINUTES
                  value: "60"
                - name: API_BASE_URL
                  value: "https://api.mesteri.ro"
                - name: GOOGLE_APPLICATION_CREDENTIALS
                  value: "/var/secrets/google/key.json"
              volumeMounts:
                - name: gcp-sa
                  mountPath: /var/secrets/google
                  readOnly: true
          volumes:
            - name: gcp-sa
              secret:
                secretName: storage-worker-sa
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: retention-review
  namespace: platform
spec:
  schedule: "30 3 * * 0"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: storage-worker
          restartPolicy: OnFailure
          containers:
            - name: retention-review
              image: gcr.io/YOUR_PROJECT/mesteri-storage-worker:latest
              args: ["retention-review"]
              env:
                - name: LEGAL_REVIEW_WEBHOOK
                  value: "https://ops.mesteri.ro/hooks/legal-review"
                - name: GOOGLE_APPLICATION_CREDENTIALS
                  value: "/var/secrets/google/key.json"
              volumeMounts:
                - name: gcp-sa
                  mountPath: /var/secrets/google
                  readOnly: true
          volumes:
            - name: gcp-sa
              secret:
                secretName: storage-worker-sa
